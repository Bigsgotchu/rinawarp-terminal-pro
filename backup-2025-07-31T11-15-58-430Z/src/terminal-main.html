<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RinaWarp Terminal</title>
    
    <!-- xterm.js CSS -->
    <link rel="stylesheet" href="https://unpkg.com/@xterm/xterm@5.5.0/css/xterm.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            background: #0a0a0a;
            color: #00ff88;
            height: 100vh;
            overflow: hidden;
        }

        .terminal-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 16px;
            background: rgba(0, 255, 136, 0.1);
            border-bottom: 1px solid rgba(0, 255, 136, 0.3);
            backdrop-filter: blur(10px);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .logo::before {
            content: "ü¶æ";
            font-size: 20px;
        }

        .tab-controls {
            display: flex;
            gap: 8px;
        }

        .tab-btn {
            padding: 6px 16px;
            border: 1px solid rgba(0, 255, 136, 0.3);
            background: rgba(0, 255, 136, 0.05);
            color: #00ff88;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tab-btn:hover {
            background: rgba(0, 255, 136, 0.15);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
        }

        .tab-btn.active {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
        }

        .main-content {
            flex: 1;
            display: flex;
            position: relative;
            overflow: hidden;
        }

        .sidebar {
            width: 0;
            transition: width 0.3s ease;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            border-right: 1px solid rgba(0, 255, 136, 0.2);
            overflow: hidden;
        }

        .sidebar.expanded {
            width: 350px;
        }

        .terminal-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .terminal-view {
            flex: 1;
            padding: 16px;
            background: #000;
            position: relative;
            overflow: hidden;
        }

        /* Terminal specific styles */
        #terminal {
            width: 100%;
            height: 100%;
        }

        .xterm {
            font-feature-settings: "liga" 0;
            position: relative;
            user-select: none;
            -ms-user-select: none;
            -webkit-user-select: none;
        }

        .xterm.focus,
        .xterm:focus {
            outline: none;
        }

        /* Dashboard styles when active */
        .dashboard-content {
            padding: 20px;
            height: 100%;
            overflow-y: auto;
        }

        .dashboard-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .dashboard-card {
            background: rgba(0, 255, 136, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 8px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .dashboard-card h3 {
            color: #00ff88;
            margin-bottom: 15px;
            font-size: 18px;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            background: #00ff88;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .metrics-list {
            list-style: none;
        }

        .metrics-list li {
            padding: 5px 0;
            color: #aaa;
            font-family: monospace;
        }

        .metrics-list li span {
            color: #00ff88;
        }

        /* Status bar */
        .status-bar {
            padding: 4px 16px;
            background: rgba(0, 255, 136, 0.05);
            border-top: 1px solid rgba(0, 255, 136, 0.2);
            font-size: 11px;
            color: #666;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-left {
            display: flex;
            gap: 15px;
        }

        .status-right {
            display: flex;
            gap: 10px;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .header {
                padding: 6px 12px;
            }
            
            .tab-btn {
                padding: 4px 12px;
                font-size: 12px;
            }
            
            .terminal-view {
                padding: 8px;
            }
            
            .dashboard-content {
                padding: 15px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Terminal glow effects */
        .terminal-view::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center, rgba(0, 255, 136, 0.05) 0%, transparent 70%);
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="terminal-container">
        <!-- Header with toggle -->
        <div class="header">
            <div class="logo">RinaWarp Terminal</div>
            <div class="tab-controls">
                <button class="tab-btn" id="sidebar-toggle" data-view="sidebar">üìä Dashboard</button>
            </div>
        </div>

        <!-- Main content area -->
        <div class="main-content">
            <!-- Collapsible Sidebar -->
            <div class="sidebar" id="sidebar">
                <div class="dashboard-content">
                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <h3><span class="status-indicator"></span>System Status</h3>
                            <ul class="metrics-list">
                                <li>Terminal Sessions: <span id="session-count">1</span></li>
                                <li>CPU Usage: <span id="cpu-usage">12%</span></li>
                                <li>Memory Usage: <span id="memory-usage">256MB</span></li>
                                <li>Uptime: <span id="uptime">2h 14m</span></li>
                            </ul>
                        </div>

                        <div class="dashboard-card">
                            <h3>üéõÔ∏è Terminal Settings</h3>
                            <ul class="metrics-list">
                                <li>Theme: <span>Neon Green</span></li>
                                <li>Font: <span>SF Mono 14px</span></li>
                                <li>Cursor: <span>Block</span></li>
                                <li>Bell: <span>Disabled</span></li>
                            </ul>
                        </div>

                        <div class="dashboard-card">
                            <h3>ü§ñ AI Assistant</h3>
                            <ul class="metrics-list">
                                <li>Status: <span>Active</span></li>
                                <li>Model: <span>GPT-4</span></li>
                                <li>Context: <span>Terminal</span></li>
                                <li>Suggestions: <span>Enabled</span></li>
                            </ul>
                        </div>

                        <div class="dashboard-card">
                            <h3>üìà Performance</h3>
                            <ul class="metrics-list">
                                <li>Commands/min: <span id="commands-per-min">8</span></li>
                                <li>Avg Response: <span>45ms</span></li>
                                <li>Error Rate: <span>0.1%</span></li>
                                <li>Success Rate: <span>99.9%</span></li>
                            </ul>
                        </div>

                        <div class="dashboard-card">
                            <h3>üìù Recent Activity</h3>
                            <ul class="metrics-list">
                                <li>[14:32] Command executed: <span>ls -la</span></li>
                                <li>[14:31] Directory changed: <span>/Users/kgilley/rinawarp-terminal</span></li>
                                <li>[14:30] Terminal session started</li>
                                <li>[14:29] AI assistant initialized</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Terminal Container (always visible, takes up full width when sidebar collapsed) -->
            <div class="terminal-container">
                <div class="terminal-view" id="terminal-view">
                    <div id="terminal"></div>
                </div>
            </div>
        </div>

        <!-- Status bar -->
        <div class="status-bar">
            <div class="status-left">
                <span>Ready</span>
                <span>Shell: bash</span>
                <span>PWD: ~/rinawarp-terminal</span>
            </div>
            <div class="status-right">
                <span id="current-time"></span>
            </div>
        </div>
    </div>

    <!-- xterm.js and addons -->
<script src="https://unpkg.com/@xterm/xterm@5.5.0/lib/xterm.js"></script>
    <script src="https://unpkg.com/@xterm/addon-fit@0.10.0/lib/addon-fit.js"></script>
    <script src="https://unpkg.com/@xterm/addon-web-links@0.11.0/lib/addon-web-links.js"></script>

    <script>
        // AI Assistant Class for Natural Language Processing with Learning
        class TerminalAIAssistant {
            constructor() {
                this.commandHistory = [];
                this.conversationHistory = [];
                this.isActive = true;
                this.currentContext = {
                    pwd: '~',
                    shell: 'bash',
                    lastCommand: null
                };
                
                // Learning and adaptation data
                this.learningData = {
                    userPatterns: new Map(),
                    commandFrequency: new Map(),
                    contextualPatterns: new Map(),
                    timeBasedPatterns: new Map(),
                    errorPatterns: new Map(),
                    successfulSuggestions: new Map(),
                    userPreferences: {
                        verbosity: 'medium', // low, medium, high
                        helpStyle: 'friendly', // formal, friendly, concise
                        suggestionTiming: 'immediate' // immediate, delayed, on-request
                    },
                    adaptationMetrics: {
                        totalInteractions: 0,
                        successfulSuggestions: 0,
                        rejectedSuggestions: 0,
                        learningAccuracy: 0.0
                    }
                };
                
                this.initializePatterns();
                this.loadLearningData();
                this.setupAdaptiveLearning();
            }

            initializePatterns() {
                // Enhanced natural language patterns for comprehensive terminal operations
                this.languagePatterns = {
                    // File operations - much more comprehensive
                    listFiles: /(?:show|list|display|see|view|what's|whats|find|get)\s*(?:me\s+)?(?:all\s+)?(?:the\s+)?(?:files|contents|directory|folder|items|stuff|things|everything)\s*(?:here|in here|in this|current)?/i,
                    listHidden: /(?:show|list|see|display)\s*(?:all\s+)?(?:the\s+)?(?:hidden|secret|dot)\s*(?:files|folders)/i,
                    createFile: /(?:create|make|new|touch|generate|build)\s*(?:a\s+)?(?:new\s+)?(?:file|document)\s*(?:called|named)?/i,
                    deleteFile: /(?:delete|remove|rm|erase|kill|destroy)\s*(?:the\s+)?(?:file|files|document)/i,
                    copyFile: /(?:copy|duplicate|clone)\s*(?:the\s+)?(?:file|files|this)/i,
                    moveFile: /(?:move|rename|relocate)\s*(?:the\s+)?(?:file|files|this)/i,
                    editFile: /(?:edit|open|modify|change|update)\s*(?:the\s+)?(?:file|document)/i,
                    findFiles: /(?:find|search|locate|look for)\s*(?:files?|documents?)\s*(?:with|containing|named|called)?/i,
                    
                    // Navigation - more natural ways to express movement
                    changeDirectory: /(?:go\s+to|navigate\s+to|cd\s+to|change\s+to|switch\s+to|move\s+to|enter|open)\s*(?:the\s+)?(?:directory|folder|dir|path)\s*(?:called|named)?/i,
                    goHome: /(?:go\s+home|home|take me home|back to home|home directory|user directory)/i,
                    goUp: /(?:go\s+up|parent|go\s+back|up\s+one|previous|back up|cd\s+up)/i,
                    goBack: /(?:go\s+back|previous|last|return|back)/i,
                    whereAmI: /(?:where\s+am\s+i|current\s+location|pwd|present\s+working|what\s+directory)/i,
                    
                    // Git operations - comprehensive git commands
                    gitStatus: /(?:git\s+status|check\s+git|git\s+state|repository\s+status|repo\s+status|what's\s+changed|git\s+diff|show\s+changes)/i,
                    gitAdd: /(?:git\s+add|stage\s+files|add\s+to\s+git|stage\s+changes|prepare\s+for\s+commit)/i,
                    gitCommit: /(?:git\s+commit|commit\s+changes|save\s+changes|commit\s+files|create\s+commit)/i,
                    gitPush: /(?:git\s+push|push\s+changes|upload\s+changes|send\s+to\s+remote|deploy)/i,
                    gitPull: /(?:git\s+pull|pull\s+changes|download\s+changes|update\s+from\s+remote|sync|fetch)/i,
                    gitLog: /(?:git\s+log|show\s+history|commit\s+history|git\s+history|version\s+history)/i,
                    gitClone: /(?:git\s+clone|clone\s+repository|download\s+repo|get\s+repository)/i,
                    
                    // System info - detailed system queries
                    systemInfo: /(?:system\s+info|system\s+status|computer\s+info|machine\s+info|tell me about|specs|system\s+details)/i,
                    processes: /(?:show\s+processes|list\s+processes|running\s+programs|what's\s+running|active\s+processes|ps|tasks)/i,
                    diskSpace: /(?:disk\s+space|storage|free\s+space|available\s+space|df|disk\s+usage|how\s+much\s+space)/i,
                    memoryUsage: /(?:memory\s+usage|ram|memory\s+info|how\s+much\s+memory|free\s+memory)/i,
                    cpuUsage: /(?:cpu\s+usage|processor|cpu\s+info|system\s+load|performance)/i,
                    networkInfo: /(?:network|ip|wifi|internet\s+connection|network\s+status)/i,
                    
                    // Package management - npm, yarn, etc.
                    npmInstall: /(?:install|npm\s+install|add\s+package|yarn\s+add|get\s+dependencies)/i,
                    npmRun: /(?:run\s+script|npm\s+run|yarn\s+run|execute\s+script|start|build|test)/i,
                    npmList: /(?:list\s+packages|npm\s+list|show\s+dependencies|installed\s+packages)/i,
                    
                    // File content operations
                    showFileContent: /(?:show|display|read|cat|view|open)\s*(?:the\s+)?(?:contents?\s+of|file|document)/i,
                    searchInFiles: /(?:search|grep|find)\s*(?:in|within)\s*(?:files?|documents?)\s*(?:for)?/i,
                    
                    // Permissions and ownership
                    changePermissions: /(?:change\s+permissions|chmod|make\s+executable|permissions)/i,
                    changeOwner: /(?:change\s+owner|chown|ownership)/i,
                    
                    // Archives and compression
                    extract: /(?:extract|unzip|uncompress|untar|expand)/i,
                    compress: /(?:compress|zip|tar|archive|pack)/i,
                    
                    // Development operations
                    buildProject: /(?:build|compile|make|construct)\s*(?:the\s+)?(?:project|code|application)/i,
                    runTests: /(?:run\s+tests|test|execute\s+tests|check\s+tests)/i,
                    startServer: /(?:start\s+server|run\s+server|serve|launch\s+app)/i,
                    
                    // Help and explanations - more comprehensive
                    help: /(?:help|assist|what\s+can\s+you\s+do|commands|instructions|guide|tutorial|how\s+to)/i,
                    explain: /(?:explain|what\s+does|how\s+does|what\s+is|tell\s+me\s+about|describe)/i,
                    examples: /(?:examples?|show\s+me|demonstrate|sample)/i,
                    
                    // Conversational - more natural interactions
                    greeting: /(?:hello|hi|hey|good\s+morning|good\s+afternoon|good\s+evening|sup|yo|howdy|greetings)/i,
                    thanks: /(?:thank\s+you|thanks|appreciate|grateful|cheers)/i,
                    goodbye: /(?:bye|goodbye|see\s+you|farewell|exit|quit|later)/i,
                    status: /(?:how\s+are\s+you|status|are\s+you\s+working|are\s+you\s+ok)/i,
                    
                    // AI trigger words - more ways to address Rina
                    aiTrigger: /(?:rina|ai|assistant|help\s+me|can\s+you|could\s+you|please)/i,
                    
                    // Question patterns
                    whatIs: /(?:what\s+is|what's|whats)\s*(?:a|an|the)?/i,
                    howTo: /(?:how\s+to|how\s+do\s+i|how\s+can\s+i)/i,
                    whereIs: /(?:where\s+is|where's|wheres|locate)/i,
                    
                    // Common typos and variations
                    listFiles2: /(?:ls|ll|la|dir)/i, // Common commands
                    clear: /(?:clear|cls|clean)/i,
                    
                    // Time and date
                    timeDate: /(?:what\s+time|current\s+time|date|today|now)/i
                };
            }

            async processNaturalLanguage(input) {
                const cleanInput = input.trim().toLowerCase();
                
                // Check for direct patterns first
                const directCommand = this.matchDirectPatterns(cleanInput);
                if (directCommand) {
                    return {
                        type: 'command',
                        command: directCommand,
                        explanation: `Executing: ${directCommand}`,
                        confidence: 0.9
                    };
                }

                // Check for conversational responses
                const conversationalResponse = this.handleConversational(cleanInput);
                if (conversationalResponse) {
                    return {
                        type: 'response',
                        message: conversationalResponse,
                        confidence: 0.8
                    };
                }

                // Fallback response
                return {
                    type: 'fallback',
                    message: `I understand you want to: "${input}". Try being more specific or type 'help' for available commands.`,
                    confidence: 0.3
                };
            }

            matchDirectPatterns(input) {
                const patterns = this.languagePatterns;

                // File operations
                if (patterns.listFiles.test(input) || patterns.listFiles2.test(input)) {
                    return 'ls -la';
                }
                if (patterns.listHidden.test(input)) {
                    return 'ls -la';
                }
                if (patterns.createFile.test(input)) {
                    const fileName = this.extractFileName(input);
                    return fileName ? `touch ${fileName}` : 'touch newfile.txt';
                }
                if (patterns.deleteFile.test(input)) {
                    const fileName = this.extractFileName(input);
                    return fileName ? `rm ${fileName}` : 'rm';
                }
                if (patterns.copyFile.test(input)) {
                    return 'cp';
                }
                if (patterns.moveFile.test(input)) {
                    return 'mv';
                }
                if (patterns.showFileContent.test(input)) {
                    const fileName = this.extractFileName(input);
                    return fileName ? `cat ${fileName}` : 'cat';
                }
                if (patterns.findFiles.test(input)) {
                    return 'find . -name';
                }
                if (patterns.searchInFiles.test(input)) {
                    return 'grep -r';
                }

                // Navigation
                if (patterns.changeDirectory.test(input)) {
                    const dirName = this.extractDirectoryName(input);
                    return dirName ? `cd ${dirName}` : 'cd';
                }
                if (patterns.goHome.test(input)) {
                    return 'cd ~';
                }
                if (patterns.goUp.test(input)) {
                    return 'cd ..';
                }
                if (patterns.goBack.test(input)) {
                    return 'cd -';
                }
                if (patterns.whereAmI.test(input)) {
                    return 'pwd';
                }

                // Git operations
                if (patterns.gitStatus.test(input)) {
                    return 'git status';
                }
                if (patterns.gitAdd.test(input)) {
                    return 'git add .';
                }
                if (patterns.gitCommit.test(input)) {
                    return 'git commit -m "Update"';
                }
                if (patterns.gitPush.test(input)) {
                    return 'git push';
                }
                if (patterns.gitPull.test(input)) {
                    return 'git pull';
                }
                if (patterns.gitLog.test(input)) {
                    return 'git log --oneline -10';
                }
                if (patterns.gitClone.test(input)) {
                    return 'git clone';
                }

                // System information
                if (patterns.systemInfo.test(input)) {
                    return 'uname -a && whoami && pwd';
                }
                if (patterns.processes.test(input)) {
                    return 'ps aux | head -10';
                }
                if (patterns.diskSpace.test(input)) {
                    return 'df -h';
                }
                if (patterns.memoryUsage.test(input)) {
                    return 'free -h';
                }
                if (patterns.cpuUsage.test(input)) {
                    return 'top -n 1 | head -20';
                }
                if (patterns.networkInfo.test(input)) {
                    return 'ifconfig';
                }

                // Package management
                if (patterns.npmInstall.test(input)) {
                    return 'npm install';
                }
                if (patterns.npmRun.test(input)) {
                    return 'npm run';
                }
                if (patterns.npmList.test(input)) {
                    return 'npm list';
                }

                // Permissions
                if (patterns.changePermissions.test(input)) {
                    return 'chmod 755';
                }
                if (patterns.changeOwner.test(input)) {
                    return 'chown';
                }

                // Archives
                if (patterns.extract.test(input)) {
                    return 'tar -xzf';
                }
                if (patterns.compress.test(input)) {
                    return 'tar -czf';
                }

                // Development
                if (patterns.buildProject.test(input)) {
                    return 'npm run build';
                }
                if (patterns.runTests.test(input)) {
                    return 'npm test';
                }
                if (patterns.startServer.test(input)) {
                    return 'npm start';
                }

                // Utility
                if (patterns.clear.test(input)) {
                    return 'clear';
                }
                if (patterns.timeDate.test(input)) {
                    return 'date';
                }

                return null;
            }

            handleConversational(input) {
                const patterns = this.languagePatterns;

                if (patterns.greeting.test(input)) {
                    return "üëã Hello! I'm Rina, your AI terminal assistant. I can help you with commands, explain what they do, or just chat. What would you like to do?";
                }

                if (patterns.help.test(input)) {
                    return `ü§ñ I can help you with:\n‚Ä¢ Natural language commands: "list files", "check git status"\n‚Ä¢ System information: "show system info"\n‚Ä¢ Navigation: "go home", "go up"\n‚Ä¢ File operations: "create file test.txt"\n\nJust type naturally - I'll understand! Try saying:\n"list files", "show system info", or "check git status"`;
                }

                if (patterns.thanks.test(input)) {
                    return "üòä You're welcome! Anything else I can help with?";
                }

                if (patterns.goodbye.test(input)) {
                    return "üëã Goodbye! Type 'rina' or 'hi' anytime to chat again.";
                }

                return null;
            }

            extractFileName(input) {
                // Look for quoted strings or common file extensions
                const quoted = input.match(/"([^"]+)"|'([^']+)'/);
                if (quoted) return quoted[1] || quoted[2];

                const fileMatch = input.match(/(\w+\.\w+)/);
                if (fileMatch) return fileMatch[1];

                return null;
            }

            extractDirectoryName(input) {
                const quoted = input.match(/"([^"]+)"|'([^']+)'/);
                if (quoted) return quoted[1] || quoted[2];

                const pathMatch = input.match(/(?:to|into)\s+([^\s]+)/);
                if (pathMatch) return pathMatch[1];

                return null;
            }

            isNaturalLanguage(input) {
                // Simple heuristics to detect natural language vs direct commands
                if (!input || input.length < 3) return false;
                
                const indicators = [
                    /\b(?:can you|could you|please|how do i|how to|what is|show me|tell me)\b/i,
                    /\b(?:list|show|display|create|make|delete|remove)\b.*\b(?:files?|directories?|folders?)\b/i,
                    /\?$/, // Questions
                    this.languagePatterns.greeting,
                    this.languagePatterns.help,
                    this.languagePatterns.thanks,
                    this.languagePatterns.aiTrigger,
                    input.split(' ').length > 2 // Multi-word phrases
                ];

                return indicators.some(pattern => pattern.test(input));
            }

            addToHistory(command) {
                this.commandHistory.push({
                    command,
                    timestamp: new Date().toISOString()
                });

                // Keep only last 20 commands
                if (this.commandHistory.length > 20) {
                    this.commandHistory = this.commandHistory.slice(-20);
                }
            }
        }

        class RinaWarpTerminal {
            constructor() {
                this.terminal = null;
                this.fitAddon = null;
                this.currentView = 'terminal';
                
                this.init();
                this.setupEventListeners();
                this.startMetricsUpdates();
            }

            init() {
// Initialize the AI assistant
                this.aiAssistant = new TerminalAIAssistant();

                // Initialize xterm.js
                this.terminal = new Terminal({
                    theme: {
                        background: '#000000',
                        foreground: '#00ff88',
                        cursor: '#00ff88',
                        cursorAccent: '#000000',
                        selection: 'rgba(0, 255, 136, 0.3)',
                        black: '#000000',
                        red: '#ff0066',
                        green: '#00ff88',
                        yellow: '#ffaa00',
                        blue: '#0088ff',
                        magenta: '#ff00aa',
                        cyan: '#00aaff',
                        white: '#ffffff'
                    },
                    fontFamily: '"SF Mono", Monaco, "Inconsolata", "Fira Code", monospace',
                    fontSize: 14,
                    lineHeight: 1.2,
                    cursorBlink: true,
                    cursorStyle: 'block',
                    scrollback: 1000,
                    tabStopWidth: 4,
                    allowTransparency: true
                });

                // Add fit addon
                this.fitAddon = new FitAddon.FitAddon();
                this.terminal.loadAddon(this.fitAddon);

                // Add web links addon
                this.terminal.loadAddon(new WebLinksAddon.WebLinksAddon());

                // Open terminal in the container
                this.terminal.open(document.getElementById('terminal'));
                
                // Fit terminal to container
                this.fitAddon.fit();

// Welcome message
                this.terminal.writeln('\x1b[32mü¶æ RinaWarp Terminal v1.0.19 initialized...\x1b[0m');
                this.terminal.writeln('\x1b[36mü§ñ AI Assistant "Rina" is active - try natural language!\x1b[0m');
                this.terminal.writeln('\x1b[90mType "help" for commands, or try: "list files", "show system info"\x1b[0m');
                this.terminal.writeln('');
                this.terminal.write('\x1b[32m$\x1b[0m ');

// Handle input
                let currentInput = '';
                this.terminal.onData(data => {
                    if (data === '\r') {
                        // Enter pressed - check if it's natural language
                        this.terminal.writeln('');
                        
                        if (this.aiAssistant.isNaturalLanguage(currentInput)) {
                            // Process as natural language
                            this.aiAssistant.processNaturalLanguage(currentInput).then((result) => {
                                if (result.type === 'command') {
                                    this.terminal.writeln(`\x1b[36müí° Suggested command: ${result.command}\x1b[0m`);
                                    this.terminal.writeln(result.explanation);
                                } else if (result.type === 'response') {
                                    this.terminal.writeln(`\x1b[35mü§ñ Rina: \x1b[0m${result.message}`);
                                } else if (result.type === 'fallback') {
                                    this.terminal.writeln(`\x1b[33müí≠ ${result.message}\x1b[0m`);
                                }
                                currentInput = '';
                                this.terminal.write('\x1b[32m$\x1b[0m ');
                            });
                        } else {
                            // Process as regular command
                            this.handleCommand(currentInput.trim());
                            this.aiAssistant.addToHistory(currentInput.trim());
                            currentInput = '';
                            this.terminal.write('\x1b[32m$\x1b[0m ');
                        }
                    } else if (data === '\u007f') {
                        // Backspace pressed
                        if (currentInput.length > 0) {
                            currentInput = currentInput.slice(0, -1);
                            this.terminal.write('\b \b');
                        }
                    } else if (data === '\u0003') {
                        // Ctrl+C pressed
                        this.terminal.writeln('^C');
                        currentInput = '';
                        this.terminal.write('\x1b[32m$\x1b[0m ');
                    } else {
                        // Regular character
                        currentInput += data;
                        this.terminal.write(data);
                    }
                });

                // Handle resize
                window.addEventListener('resize', () => {
                    this.fitAddon.fit();
                });
            }

            setupEventListeners() {
                // Sidebar toggle
                const sidebarToggle = document.getElementById('sidebar-toggle');
                const sidebar = document.getElementById('sidebar');
                this.sidebarExpanded = false;

                this.toggleSidebar = () => {
                    this.sidebarExpanded = !this.sidebarExpanded;
                    if (this.sidebarExpanded) {
                        sidebar.classList.add('expanded');
                        sidebarToggle.classList.add('active');
                        sidebarToggle.innerHTML = 'üìä Dashboard (Hide)';
                    } else {
                        sidebar.classList.remove('expanded');
                        sidebarToggle.classList.remove('active');
                        sidebarToggle.innerHTML = 'üìä Dashboard';
                    }
                    // Refit terminal after sidebar animation completes
                    setTimeout(() => {
                        this.fitAddon.fit();
                    }, 350);
                };

                sidebarToggle.addEventListener('click', this.toggleSidebar);

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    // Ctrl+D to toggle dashboard
                    if (e.ctrlKey && e.key === 'd') {
                        e.preventDefault();
                        this.toggleSidebar();
                    }
                    
                    // Escape to hide sidebar
                    if (e.key === 'Escape' && this.sidebarExpanded) {
                        this.toggleSidebar();
                        this.terminal.focus();
                    }
                });
            }


            handleCommand(command) {
                const cmd = command.toLowerCase();
                
                switch (cmd) {
                    case 'help':
                        this.terminal.writeln('Available commands:');
                        this.terminal.writeln('  help       - Show this help message');
                        this.terminal.writeln('  clear      - Clear the terminal');
                        this.terminal.writeln('  dashboard  - Switch to dashboard view');
                        this.terminal.writeln('  status     - Show system status');
                        this.terminal.writeln('  version    - Show version info');
                        this.terminal.writeln('  exit       - Close terminal');
                        break;
                        
                    case 'clear':
                        this.terminal.clear();
                        break;
                        
                    case 'dashboard':
                        this.terminal.writeln('Opening dashboard sidebar...');
                        if (!this.sidebarExpanded) {
                            this.toggleSidebar();
                        }
                        break;
                        
                    case 'status':
                        this.terminal.writeln('\x1b[32mSystem Status:\x1b[0m');
                        this.terminal.writeln('  Terminal: Active');
                        this.terminal.writeln('  AI Assistant: Ready');
                        this.terminal.writeln('  Memory Usage: 256MB');
                        this.terminal.writeln('  CPU Usage: 12%');
                        break;
                        
                    case 'version':
                        this.terminal.writeln('\x1b[32mRinaWarp Terminal v1.0.19\x1b[0m');
                        this.terminal.writeln('Built with xterm.js and modern web technologies');
                        break;
                        
                    case 'exit':
                        this.terminal.writeln('Goodbye! üëã');
                        break;
                        
                    default:
                        if (command.trim()) {
                            this.terminal.writeln(`\x1b[31mCommand not found: ${command}\x1b[0m`);
                            this.terminal.writeln('Type "help" for available commands');
                        }
                }
            }

            startMetricsUpdates() {
                // Update current time
                const updateTime = () => {
                    const now = new Date();
                    document.getElementById('current-time').textContent = 
                        now.toLocaleTimeString();
                };
                updateTime();
                setInterval(updateTime, 1000);

                // Simulate metrics updates
                setInterval(() => {
                    const cpuUsage = Math.floor(Math.random() * 20) + 5;
                    const memoryUsage = Math.floor(Math.random() * 100) + 200;
                    const commandsPerMin = Math.floor(Math.random() * 15) + 5;
                    
                    const cpuEl = document.getElementById('cpu-usage');
                    const memEl = document.getElementById('memory-usage');
                    const cmdEl = document.getElementById('commands-per-min');
                    
                    if (cpuEl) cpuEl.textContent = `${cpuUsage}%`;
                    if (memEl) memEl.textContent = `${memoryUsage}MB`;
                    if (cmdEl) cmdEl.textContent = commandsPerMin.toString();
                }, 5000);
            }
        }

        // Initialize the terminal when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new RinaWarpTerminal();
        });
    </script>
</body>
</html>
