<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversion Tracking Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .test-container { background: white; padding: 20px; border-radius: 8px; max-width: 800px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 10px; margin: 10px 0; max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ RinaWarp Conversion Tracking Test</h1>
        <p>This page tests the conversion tracking functionality implemented in pricing-simplified.html</p>
        
        <div id="test-results"></div>
        
        <h3>Manual Tests</h3>
        <button onclick="testGtagFunction()">Test gtag Function</button>
        <button onclick="testPlanSelection()">Test Plan Selection Event</button>
        <button onclick="testScrollTracking()">Test Scroll Tracking</button>
        <button onclick="testTimeTracking()">Test Time on Page</button>
        <button onclick="clearLog()">Clear Log</button>
        
        <h3>Event Log</h3>
        <div id="event-log" class="log"></div>
        
        <h3>Analytics Status</h3>
        <div id="analytics-status"></div>
    </div>

    <!-- Load Google Analytics (same setup as pricing page) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-G424CV5GGT"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-G424CV5GGT', {
            send_page_view: false, // Don't auto-send page view for test
            anonymize_ip: true,
            allow_google_signals: false
        });
    </script>

    <script>
        // Event logging system
        const eventLog = document.getElementById('event-log');
        const testResults = document.getElementById('test-results');
        const analyticsStatus = document.getElementById('analytics-status');
        
        function logEvent(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${timestamp}] ${message}`;
            eventLog.appendChild(logEntry);
            eventLog.scrollTop = eventLog.scrollHeight;
        }
        
        function addTestResult(message, success = true) {
            const result = document.createElement('div');
            result.className = `test-result ${success ? 'success' : 'error'}`;
            result.textContent = (success ? '‚úÖ ' : '‚ùå ') + message;
            testResults.appendChild(result);
        }
        
        function clearLog() {
            eventLog.innerHTML = '';
            testResults.innerHTML = '';
        }
        
        // Override gtag to capture events for testing
        const originalGtag = window.gtag;
        window.gtag = function() {
            logEvent(`gtag called: ${Array.from(arguments).map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg) : arg
            ).join(', ')}`);
            return originalGtag.apply(this, arguments);
        };
        
        // Test functions
        function testGtagFunction() {
            try {
                if (typeof gtag === 'function') {
                    addTestResult('gtag function exists');
                    
                    // Test basic event
                    gtag('event', 'test_event', {
                        event_category: 'test',
                        event_label: 'basic_test',
                        value: 1
                    });
                    
                    addTestResult('Basic gtag event sent successfully');
                } else {
                    addTestResult('gtag function not found', false);
                }
            } catch (error) {
                addTestResult(`gtag test failed: ${error.message}`, false);
                logEvent(`Error: ${error.message}`, 'error');
            }
        }
        
        function testPlanSelection() {
            try {
                // Simulate plan selection event (same as in pricing page)
                gtag('event', 'select_item', {
                    currency: 'USD',
                    value: 25.00,
                    items: [{
                        item_id: 'professional_plan',
                        item_name: 'Professional Plan',
                        item_category: 'subscription',
                        price: 25.00,
                        currency: 'USD',
                        quantity: 1
                    }],
                    plan_selected: 'Professional',
                    selection_method: 'test_button',
                    time_on_page: 30
                });
                
                addTestResult('Plan selection event sent successfully');
            } catch (error) {
                addTestResult(`Plan selection test failed: ${error.message}`, false);
                logEvent(`Error: ${error.message}`, 'error');
            }
        }
        
        function testScrollTracking() {
            try {
                // Simulate scroll tracking event
                gtag('event', 'scroll', {
                    event_category: 'engagement',
                    event_label: 'test_page_scroll',
                    value: 50,
                    scroll_depth: 50,
                    time_to_scroll: 15
                });
                
                addTestResult('Scroll tracking event sent successfully');
            } catch (error) {
                addTestResult(`Scroll tracking test failed: ${error.message}`, false);
                logEvent(`Error: ${error.message}`, 'error');
            }
        }
        
        function testTimeTracking() {
            try {
                // Simulate time on page event
                gtag('event', 'time_on_page', {
                    event_category: 'engagement',
                    event_label: 'test_page_time',
                    value: 60,
                    time_milestone: '60_seconds'
                });
                
                addTestResult('Time tracking event sent successfully');
            } catch (error) {
                addTestResult(`Time tracking test failed: ${error.message}`, false);
                logEvent(`Error: ${error.message}`, 'error');
            }
        }
        
        // Check analytics status on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                let status = '<div class="test-result info">';
                
                // Check if gtag is loaded
                if (typeof gtag === 'function') {
                    status += '‚úÖ Google Analytics gtag loaded<br>';
                } else {
                    status += '‚ùå Google Analytics gtag not loaded<br>';
                }
                
                // Check if dataLayer exists
                if (window.dataLayer && Array.isArray(window.dataLayer)) {
                    status += `‚úÖ DataLayer exists with ${window.dataLayer.length} items<br>`;
                } else {
                    status += '‚ùå DataLayer not found<br>';
                }
                
                // Check if GA script loaded
                const gaScripts = document.querySelectorAll('script[src*="googletagmanager.com"]');
                if (gaScripts.length > 0) {
                    status += '‚úÖ Google Analytics script loaded<br>';
                } else {
                    status += '‚ùå Google Analytics script not found<br>';
                }
                
                status += '</div>';
                analyticsStatus.innerHTML = status;
                
                logEvent('Analytics status check completed');
            }, 2000);
        });
        
        // Log initial page load
        logEvent('Test page loaded - starting conversion tracking tests');
    </script>
</body>
</html>
