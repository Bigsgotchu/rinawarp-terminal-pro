<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RinaWarp Flash Sale - Real-time Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            overflow-x: hidden;
        }

        .dashboard {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(45deg, #ff6b35, #ff8e53);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(255, 107, 53, 0.3);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            animation: pulse 2s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.05); }
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #00ff88;
            border-radius: 50%;
            margin-left: 10px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(255, 107, 53, 0.2);
            border-color: #ff6b35;
        }

        .metric-number {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b35, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .metric-label {
            font-size: 1.1em;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .metric-change {
            font-size: 0.9em;
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-block;
        }

        .metric-change.positive {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        .metric-change.negative {
            background: rgba(255, 107, 53, 0.2);
            color: #ff6b35;
        }

        .charts-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }

        .chart-title {
            font-size: 1.3em;
            margin-bottom: 20px;
            text-align: center;
        }

        .conversion-funnel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .funnel-step {
            background: rgba(255, 107, 53, 0.1);
            border-left: 4px solid #ff6b35;
            padding: 15px 20px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .funnel-step.active {
            background: rgba(0, 255, 136, 0.1);
            border-left-color: #00ff88;
            animation: highlightPulse 2s ease-in-out infinite;
        }

        @keyframes highlightPulse {
            0%, 100% { box-shadow: 0 0 5px rgba(0, 255, 136, 0.3); }
            50% { box-shadow: 0 0 20px rgba(0, 255, 136, 0.6); }
        }

        .recent-events {
            max-height: 400px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
        }

        .event-item {
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 3px solid #ff6b35;
            animation: slideIn 0.3s ease-out;
        }

        .event-item.critical {
            border-left-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .event-time {
            font-size: 0.8em;
            opacity: 0.6;
            margin-bottom: 5px;
        }

        .alerts-section {
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid #ff6b35;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .alert-item {
            padding: 10px;
            background: rgba(255, 107, 53, 0.2);
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .alert-icon {
            margin-right: 10px;
            font-size: 1.2em;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .control-btn {
            padding: 12px 24px;
            background: linear-gradient(45deg, #ff6b35, #ff8e53);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
        }

        .live-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 0.9em;
            backdrop-filter: blur(10px);
        }

        @media (max-width: 768px) {
            .charts-section {
                grid-template-columns: 1fr;
            }
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="live-indicator">
        üî¥ LIVE <span class="status-indicator"></span>
    </div>

    <div class="dashboard">
        <div class="header">
            <h1>üî• Flash Sale Dashboard</h1>
            <p>Real-time monitoring of RinaWarp Terminal promotion</p>
            <div id="saleTimer" class="sale-timer"></div>
        </div>

        <div class="alerts-section" id="alertsSection" style="display: none;">
            <h3>‚ö†Ô∏è Active Alerts</h3>
            <div id="alertsList"></div>
        </div>

        <div class="controls">
            <button class="control-btn" onclick="refreshData()">üîÑ Refresh</button>
            <button class="control-btn" onclick="exportData()">üìä Export Data</button>
            <button class="control-btn" onclick="toggleAutoRefresh()">‚èØÔ∏è Auto Refresh</button>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-number" id="totalVisitors">0</div>
                <div class="metric-label">Total Visitors</div>
                <div class="metric-change positive" id="visitorsChange">+0%</div>
            </div>
            <div class="metric-card">
                <div class="metric-number" id="conversionRate">0%</div>
                <div class="metric-label">Conversion Rate</div>
                <div class="metric-change" id="conversionChange">0%</div>
            </div>
            <div class="metric-card">
                <div class="metric-number" id="revenue">$0</div>
                <div class="metric-label">Revenue Generated</div>
                <div class="metric-change positive" id="revenueChange">+$0</div>
            </div>
            <div class="metric-card">
                <div class="metric-number" id="popupShows">0</div>
                <div class="metric-label">Exit-Intent Triggers</div>
                <div class="metric-change" id="popupChange">0</div>
            </div>
        </div>

        <div class="charts-section">
            <div class="chart-container">
                <h3 class="chart-title">üìà Conversion Funnel</h3>
                <div class="conversion-funnel">
                    <div class="funnel-step">
                        <span>üë• Page Views</span>
                        <span id="funnelViews">0</span>
                    </div>
                    <div class="funnel-step">
                        <span>üëÄ Banner Clicks</span>
                        <span id="funnelBanner">0</span>
                    </div>
                    <div class="funnel-step">
                        <span>‚ö° Exit-Intent Popups</span>
                        <span id="funnelPopups">0</span>
                    </div>
                    <div class="funnel-step">
                        <span>üì• Download Starts</span>
                        <span id="funnelDownloads">0</span>
                    </div>
                    <div class="funnel-step active">
                        <span>üí∞ Purchases</span>
                        <span id="funnelPurchases">0</span>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <h3 class="chart-title">üìä Recent Events</h3>
                <div class="recent-events" id="recentEvents">
                    <p style="text-align: center; opacity: 0.6;">Loading events...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let autoRefresh = true;
        let refreshInterval;
        let lastUpdate = Date.now();
        
        const API_BASE = 'http://18.212.105.169/api';
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            refreshData();
            startAutoRefresh();
            updateSaleTimer();
            setInterval(updateSaleTimer, 1000);
        });

        function startAutoRefresh() {
            if (refreshInterval) clearInterval(refreshInterval);
            refreshInterval = setInterval(refreshData, 10000); // Refresh every 10 seconds
        }

        function toggleAutoRefresh() {
            autoRefresh = !autoRefresh;
            const btn = event.target;
            
            if (autoRefresh) {
                startAutoRefresh();
                btn.textContent = '‚èØÔ∏è Auto Refresh';
                btn.style.background = 'linear-gradient(45deg, #ff6b35, #ff8e53)';
            } else {
                clearInterval(refreshInterval);
                btn.textContent = '‚ñ∂Ô∏è Start Refresh';
                btn.style.background = 'linear-gradient(45deg, #666, #888)';
            }
        }

        async function refreshData() {
            try {
                console.log('üîÑ Refreshing dashboard data...');
                
                // Simulate API call (replace with actual API)
                const mockData = generateMockData();
                updateMetrics(mockData);
                updateFunnel(mockData);
                updateRecentEvents(mockData);
                checkAlerts(mockData);
                
                lastUpdate = Date.now();
                console.log('‚úÖ Dashboard updated');
                
            } catch (error) {
                console.error('‚ùå Error refreshing data:', error);
                showAlert('Failed to refresh data', 'error');
            }
        }

        function generateMockData() {
            // This simulates real-time data - replace with actual API calls
            const baseTime = Date.now() - (1000 * 60 * 60 * 2); // 2 hours ago
            
            return {
                totalVisitors: Math.floor(Math.random() * 500) + 100,
                conversionRate: (Math.random() * 15 + 5).toFixed(1),
                revenue: Math.floor(Math.random() * 5000) + 1000,
                popupShows: Math.floor(Math.random() * 200) + 50,
                funnel: {
                    views: Math.floor(Math.random() * 500) + 200,
                    bannerClicks: Math.floor(Math.random() * 150) + 50,
                    popups: Math.floor(Math.random() * 100) + 30,
                    downloads: Math.floor(Math.random() * 80) + 20,
                    purchases: Math.floor(Math.random() * 30) + 5
                },
                recentEvents: [
                    { type: 'purchase_complete', time: Date.now() - 30000, details: 'Pro Plan - $29' },
                    { type: 'download_start', time: Date.now() - 45000, details: 'macOS version' },
                    { type: 'popup_convert', time: Date.now() - 67000, details: 'Exit-intent converted' },
                    { type: 'banner_click', time: Date.now() - 89000, details: 'Urgency banner' },
                    { type: 'page_view', time: Date.now() - 120000, details: 'New visitor from Twitter' }
                ]
            };
        }

        function updateMetrics(data) {
            document.getElementById('totalVisitors').textContent = data.totalVisitors;
            document.getElementById('conversionRate').textContent = data.conversionRate + '%';
            document.getElementById('revenue').textContent = '$' + data.revenue;
            document.getElementById('popupShows').textContent = data.popupShows;
            
            // Simulate changes (would come from API comparison)
            const changes = {
                visitors: Math.floor(Math.random() * 20) + 5,
                conversion: (Math.random() * 2 - 1).toFixed(1),
                revenue: Math.floor(Math.random() * 500) + 100,
                popup: Math.floor(Math.random() * 10) + 2
            };
            
            document.getElementById('visitorsChange').textContent = `+${changes.visitors}%`;
            document.getElementById('conversionChange').textContent = `${changes.conversion > 0 ? '+' : ''}${changes.conversion}%`;
            document.getElementById('conversionChange').className = `metric-change ${changes.conversion > 0 ? 'positive' : 'negative'}`;
            document.getElementById('revenueChange').textContent = `+$${changes.revenue}`;
            document.getElementById('popupChange').textContent = `+${changes.popup}`;
        }

        function updateFunnel(data) {
            document.getElementById('funnelViews').textContent = data.funnel.views;
            document.getElementById('funnelBanner').textContent = data.funnel.bannerClicks;
            document.getElementById('funnelPopups').textContent = data.funnel.popups;
            document.getElementById('funnelDownloads').textContent = data.funnel.downloads;
            document.getElementById('funnelPurchases').textContent = data.funnel.purchases;
        }

        function updateRecentEvents(data) {
            const container = document.getElementById('recentEvents');
            container.innerHTML = '';
            
            data.recentEvents.forEach(event => {
                const eventDiv = document.createElement('div');
                eventDiv.className = `event-item ${event.type === 'purchase_complete' ? 'critical' : ''}`;
                
                const timeAgo = Math.floor((Date.now() - event.time) / 1000);
                const timeText = timeAgo < 60 ? `${timeAgo}s ago` : `${Math.floor(timeAgo / 60)}m ago`;
                
                eventDiv.innerHTML = `
                    <div class="event-time">${timeText}</div>
                    <div><strong>${formatEventType(event.type)}</strong> - ${event.details}</div>
                `;
                
                container.appendChild(eventDiv);
            });
        }

        function formatEventType(type) {
            const typeMap = {
                'purchase_complete': 'üí∞ Purchase',
                'download_start': 'üì• Download',
                'popup_convert': '‚ö° Popup Convert',
                'banner_click': 'üéØ Banner Click',
                'page_view': 'üëÅÔ∏è Page View'
            };
            return typeMap[type] || type;
        }

        function checkAlerts(data) {
            const alerts = [];
            
            // Check for high conversion rate
            if (parseFloat(data.conversionRate) > 12) {
                alerts.push({
                    type: 'success',
                    message: `üéâ High conversion rate: ${data.conversionRate}%!`
                });
            }
            
            // Check for revenue milestone
            if (data.revenue > 4000) {
                alerts.push({
                    type: 'success',
                    message: `üí∞ Revenue milestone reached: $${data.revenue}`
                });
            }
            
            // Check for low banner engagement
            const bannerRate = (data.funnel.bannerClicks / data.funnel.views * 100).toFixed(1);
            if (bannerRate < 15) {
                alerts.push({
                    type: 'warning',
                    message: `‚ö†Ô∏è Low banner click rate: ${bannerRate}%`
                });
            }
            
            displayAlerts(alerts);
        }

        function displayAlerts(alerts) {
            const section = document.getElementById('alertsSection');
            const list = document.getElementById('alertsList');
            
            if (alerts.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            list.innerHTML = '';
            
            alerts.forEach(alert => {
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert-item';
                alertDiv.innerHTML = `
                    <span class="alert-icon">${alert.type === 'success' ? '‚úÖ' : '‚ö†Ô∏è'}</span>
                    <span>${alert.message}</span>
                `;
                list.appendChild(alertDiv);
            });
        }

        function updateSaleTimer() {
            // Set sale end time (24 hours from now for demo)
            const saleEnd = new Date(Date.now() + (24 * 60 * 60 * 1000));
            const now = new Date();
            const timeLeft = saleEnd - now;
            
            if (timeLeft <= 0) {
                document.getElementById('saleTimer').innerHTML = '‚è∞ <strong>SALE ENDED</strong>';
                return;
            }
            
            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
            
            document.getElementById('saleTimer').innerHTML = 
                `‚è∞ Sale ends in: <strong>${hours}h ${minutes}m ${seconds}s</strong>`;
        }

        function exportData() {
            // Generate CSV export
            const data = [
                ['Metric', 'Value', 'Timestamp'],
                ['Total Visitors', document.getElementById('totalVisitors').textContent, new Date().toISOString()],
                ['Conversion Rate', document.getElementById('conversionRate').textContent, new Date().toISOString()],
                ['Revenue', document.getElementById('revenue').textContent, new Date().toISOString()],
                ['Exit-Intent Triggers', document.getElementById('popupShows').textContent, new Date().toISOString()]
            ];
            
            const csv = data.map(row => row.join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `flash-sale-data-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            console.log('üìä Data exported successfully');
        }

        function showAlert(message, type = 'info') {
            // Simple alert system
            const alertDiv = document.createElement('div');
            alertDiv.style.cssText = `
                position: fixed; top: 80px; right: 20px; z-index: 1000;
                background: ${type === 'error' ? '#ff4444' : '#44ff44'};
                color: white; padding: 15px 20px; border-radius: 8px;
                animation: slideIn 0.3s ease-out;
            `;
            alertDiv.textContent = message;
            
            document.body.appendChild(alertDiv);
            setTimeout(() => {
                alertDiv.style.animation = 'slideOut 0.3s ease-in forwards';
                setTimeout(() => document.body.removeChild(alertDiv), 300);
            }, 3000);
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 'r':
                        e.preventDefault();
                        refreshData();
                        break;
                    case 'e':
                        e.preventDefault();
                        exportData();
                        break;
                    case 'p':
                        e.preventDefault();
                        toggleAutoRefresh();
                        break;
                }
            }
        });

        console.log('üî• Flash Sale Dashboard initialized!');
        console.log('Keyboard shortcuts: Ctrl+R (refresh), Ctrl+E (export), Ctrl+P (toggle auto-refresh)');
    </script>
</body>
</html>
