<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="robots" content="index, follow">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RinaWarp Terminal - WebSocket Test Client</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #0d1117;
            color: #c9d1d9;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #00ff88, #00d4aa);
            color: #0d1117;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .status {
            background-color: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .terminal-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .terminal {
            background-color: #0d1117;
            border: 2px solid #00ff88;
            border-radius: 6px;
            padding: 15px;
            min-height: 400px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .input-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        input[type="text"] {
            flex: 1;
            background-color: #21262d;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 10px;
            color: #c9d1d9;
            font-family: 'Courier New', monospace;
        }

        button {
            background: linear-gradient(135deg, #00ff88, #00d4aa);
            color: #0d1117;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.2s;
        }

        button:hover {
            opacity: 0.9;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .controls {
            background-color: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .controls h3 {
            margin-top: 0;
            color: #00ff88;
        }

        .log {
            background-color: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-size: 12px;
        }

        .connected {
            color: #00ff88;
        }

        .disconnected {
            color: #ff4444;
        }

        .error {
            color: #ff6b6b;
        }

        .info {
            color: #58a6ff;
        }

        @media (max-width: 768px) {
            .terminal-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <script src="js/csp-handlers-terminal-client.js"></script>
    <link rel="canonical" href="https://www.rinawarptech.com/html/terminal-client.html">

    <!-- OTTO SEO Pixel -->
    <script type="text/javascript">
      !function(o,t,t,o){
        o.OttoSeoObject=t,o[t]=o[t]||function(){
          (o[t].q=o[t].q||[]).push(arguments)
        },o[t].l=1*new Date();
        var e=document.createElement("script"),
        n=document.getElementsByTagName("script")[0];
        e.async=1,
        e.src="https://pixel.otto-seo.com/pixel.js",
        n.parentNode.insertBefore(e,n)
      }(window,document,"ottoseo","script");
      
      // Initialize OTTO with your pixel ID
      ottoseo('init', '145-919');
      
      // Track page view
      ottoseo('track', 'PageView', {
        page_url: 'https://www.rinawarptech.com/html/terminal-client.html',
        page_title: document.title,
        site_name: 'RinaWarp Terminal',
        timestamp: new Date().toISOString()
      });
      
      // Track SEO modifications
      ottoseo('track', 'SEOPageLoad', {
        meta_title: document.querySelector('title') ? document.querySelector('title').textContent : '',
        meta_description: document.querySelector('meta[name="description"]') ? document.querySelector('meta[name="description"]').content : '',
        canonical_url: document.querySelector('link[rel="canonical"]') ? document.querySelector('link[rel="canonical"]').href : '',
        page_path: 'html/terminal-client.html'
      });
    </script>
    <!-- End OTTO SEO Pixel -->
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üñ•Ô∏è RinaWarp Terminal - WebSocket Test Client</h1>
            <p>Real-time terminal communication testing interface</p>
        </div>

        <div class="status">
            <h3>Connection Status</h3>
            <p>WebSocket Status: <span id="wsStatus" class="disconnected">Disconnected</span></p>
            <p>Session ID: <span id="sessionId">None</span></p>
            <p>Connected Clients: <span id="connectedClients">-</span></p>
            <p>Active Sessions: <span id="activeSessions">-</span></p>
        </div>

        <div class="controls">
            <h3>üéÆ Controls</h3>
            <button id="connectBtn" data-onclick="connect()" class="csp-event-handler">Connect to WebSocket</button>
            <button id="disconnectBtn" data-onclick="disconnect()" class="csp-event-handler" disabled>Disconnect</button>
            <button id="createTerminalBtn" data-onclick="createTerminal()" class="csp-event-handler" disabled>Create Terminal Session</button>
            <button id="closeTerminalBtn" data-onclick="closeTerminal()" class="csp-event-handler" disabled>Close Terminal</button>
            <button id="refreshStatusBtn" data-onclick="refreshStatus()" class="csp-event-handler">Refresh Status</button>
        </div>

        <div class="terminal-container">
            <div>
                <h3>üñ•Ô∏è Terminal Output</h3>
                <div id="terminal" class="terminal"></div>
                <div class="input-container">
                    <input type="text" id="terminalInput" placeholder="Type command and press Enter..." disabled>
                    <button data-onclick="sendCommand()" class="csp-event-handler" disabled id="sendBtn">Send</button>
                </div>
            </div>

            <div>
                <h3>üìã Debug Log</h3>
                <div id="log" class="log"></div>
                <button data-onclick="clearLog()" class="csp-event-handler" style="margin-top: 10px;">Clear Log</button>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket = null;
        let sessionId = null;
        let isConnected = false;

        // Logging utility
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'error' : type === 'success' ? 'connected' : 'info';
            logElement.innerHTML += `<div class="${colorClass}">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // Terminal output utility
        function appendToTerminal(text) {
            const terminal = document.getElementById('terminal');
            terminal.textContent += text;
            terminal.scrollTop = terminal.scrollHeight;
        }

        function clearTerminal() {
            document.getElementById('terminal').textContent = '';
        }

        // Update UI state
        function updateUI() {
            document.getElementById('wsStatus').textContent = isConnected ? 'Connected' : 'Disconnected';
            document.getElementById('wsStatus').className = isConnected ? 'connected' : 'disconnected';
            document.getElementById('sessionId').textContent = sessionId || 'None';
            
            document.getElementById('connectBtn').disabled = isConnected;
            document.getElementById('disconnectBtn').disabled = !isConnected;
            document.getElementById('createTerminalBtn').disabled = !isConnected;
            document.getElementById('closeTerminalBtn').disabled = !sessionId;
            document.getElementById('terminalInput').disabled = !sessionId;
            document.getElementById('sendBtn').disabled = !sessionId;
        }

        // WebSocket connection
        function connect() {
            const wsUrl = `${window.location.protocol === 'https:' ? 'wss:' : 'ws:'}//${window.location.host}`;
            log(`Connecting to ${wsUrl}...`);
            
            socket = io(wsUrl, {
                transports: ['websocket', 'polling'],
                auth: {
                    token: 'test-user-' + Math.random().toString(36).substr(2, 9)
                }
            });

            socket.on('connect', () => {
                isConnected = true;
                log('Connected to WebSocket server', 'success');
                updateUI();
            });

            socket.on('connected', (data) => {
                log(`Server acknowledgment: ${JSON.stringify(data)}`, 'success');
            });

            socket.on('disconnect', (reason) => {
                isConnected = false;
                sessionId = null;
                log(`Disconnected: ${reason}`, 'error');
                updateUI();
            });

            socket.on('error', (error) => {
                log(`WebSocket error: ${error.message || error}`, 'error');
            });

            // Terminal event listeners
            socket.on('terminal:created', (data) => {
                sessionId = data.sessionId;
                log(`Terminal session created: ${sessionId}`, 'success');
                clearTerminal();
                appendToTerminal(`Terminal session created: ${sessionId}\n`);
                updateUI();
            });

            socket.on('terminal:output', (output) => {
                appendToTerminal(output);
            });

            socket.on('terminal:error', (data) => {
                log(`Terminal error: ${data.error}`, 'error');
                appendToTerminal(`ERROR: ${data.error}\n`);
            });

            socket.on('terminal:closed', (data) => {
                log(`Terminal session closed: ${data.sessionId || 'unknown'}`, 'info');
                appendToTerminal(`\nTerminal session closed.\n`);
                sessionId = null;
                updateUI();
            });

            socket.on('terminal:history', (data) => {
                log(`Received terminal history: ${data.buffer.length} items`, 'info');
                clearTerminal();
                data.buffer.forEach(item => {
                    appendToTerminal(item.data);
                });
            });
        }

        function disconnect() {
            if (socket) {
                socket.disconnect();
                socket = null;
                isConnected = false;
                sessionId = null;
                log('Disconnected from WebSocket server');
                updateUI();
            }
        }

        function createTerminal() {
            if (socket && isConnected) {
                log('Creating terminal session...');
                socket.emit('terminal:create', {});
            }
        }

        function closeTerminal() {
            if (socket && sessionId) {
                log('Closing terminal session...');
                socket.emit('terminal:close');
            }
        }

        function sendCommand() {
            const input = document.getElementById('terminalInput');
            const command = input.value;
            
            if (socket && sessionId && command.trim()) {
                log(`Sending command: ${command}`);
                socket.emit('terminal:input', { input: command + '\n' });
                input.value = '';
            }
        }

        // Handle Enter key in terminal input
        document.addEventListener('DOMContentLoaded', () => {
            const terminalInput = document.getElementById('terminalInput');
            terminalInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendCommand();
                }
            });

            // Auto-connect on page load for testing
            setTimeout(() => {
                log('Auto-connecting for testing...');
                connect();
            }, 1000);
        });

        // Refresh server status
        async function refreshStatus() {
            try {
                const response = await fetch('/api/websocket/status');
                const data = await response.json();
                
                document.getElementById('connectedClients').textContent = data.connectedClients;
                document.getElementById('activeSessions').textContent = data.activeSessions;
                
                log(`Server status updated - Clients: ${data.connectedClients}, Sessions: ${data.activeSessions}`, 'success');
            } catch (error) {
                log(`Failed to refresh status: ${error.message}`, 'error');
            }
        }

        // Initialize UI
        updateUI();
        
        // Auto-refresh status every 10 seconds
        setInterval(refreshStatus, 10000);
    </script>
</body>
</html>
