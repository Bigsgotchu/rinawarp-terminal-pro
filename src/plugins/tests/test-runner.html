<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RinaWarp Terminal - Test Environment</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e1e2e, #2d3748);
            color: #ffffff;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #00ff88;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .btn {
            background: linear-gradient(135deg, #00ff88, #00cc66);
            color: #000;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            background: linear-gradient(135deg, #00cc66, #009944);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
        }

        .btn.danger {
            background: linear-gradient(135deg, #ff4757, #ff3742);
            color: white;
        }

        .btn.danger:hover {
            background: linear-gradient(135deg, #ff3742, #ff1e2d);
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
        }

        .btn.warning {
            background: linear-gradient(135deg, #ffa502, #ff8c00);
            color: white;
        }

        .btn.warning:hover {
            background: linear-gradient(135deg, #ff8c00, #ff7300);
            box-shadow: 0 4px 15px rgba(255, 165, 2, 0.3);
        }

        .results {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .test-result {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid;
        }

        .test-result.success {
            background: rgba(0, 255, 136, 0.1);
            border-left-color: #00ff88;
        }

        .test-result.error {
            background: rgba(255, 71, 87, 0.1);
            border-left-color: #ff4757;
        }

        .test-result.warning {
            background: rgba(255, 165, 2, 0.1);
            border-left-color: #ffa502;
        }

        .test-name {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .test-details {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #cccccc;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid rgba(0, 255, 136, 0.2);
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-indicator.online {
            background: #00ff88;
        }

        .status-indicator.offline {
            background: #ff4757;
        }

        .status-indicator.warning {
            background: #ffa502;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .module-test {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 6px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .module-test:hover {
            border-color: #00ff88;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.1);
        }

        .module-name {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .module-status {
            font-size: 0.9em;
            color: #cccccc;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 255, 136, 0.3);
            border-radius: 50%;
            border-top-color: #00ff88;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        pre {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 0.85em;
            border: 1px solid rgba(0, 255, 136, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ RinaWarp Terminal - Test Environment</h1>
        
        <div class="status-bar">
            <div class="status-item">
                <div id="system-status" class="status-indicator offline"></div>
                <span>System Status</span>
            </div>
            <div class="status-item">
                <span id="test-count">Tests: 0 / 0</span>
            </div>
            <div class="status-item">
                <span id="last-update">Last Update: Never</span>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="runAllTests()">üî¨ Run All Tests</button>
            <button class="btn warning" onclick="exportDiagnostics()">üìä Export Diagnostics</button>
            <button class="btn" onclick="generateSupportReport()">üìù Support Report</button>
            <button class="btn danger" onclick="clearResults()">üóëÔ∏è Clear Results</button>
        </div>

        <div class="module-grid" id="module-grid">
            <!-- Module test buttons will be generated here -->
        </div>

        <div id="results" class="results" style="display: none;">
            <h3>Test Results</h3>
            <div id="test-output"></div>
        </div>
    </div>

    <script type="module">
        // Import the test environment
import testEnvironment from '../../dist/test-environment.bundle.js';
        
        let currentTests = [];
        
        // Initialize the interface
        document.addEventListener('DOMContentLoaded', function() {
            initializeInterface();
            checkSystemStatus();
            setInterval(checkSystemStatus, 5000); // Update every 5 seconds
        });

        function initializeInterface() {
            // Create module test buttons
            const modules = [
                'electronAPI',
                'ipcBridge', 
                'pluginLoader',
                'uiManager',
                'errorTriageSystem',
                'performanceMonitor'
            ];

            const moduleGrid = document.getElementById('module-grid');
            modules.forEach(module => {
                const moduleDiv = document.createElement('div');
                moduleDiv.className = 'module-test';
                moduleDiv.onclick = () => runModuleTest(module);
                
                moduleDiv.innerHTML = `
                    <div class="module-name">${module}</div>
                    <div class="module-status" id="status-${module}">Click to test</div>
                `;
                
                moduleGrid.appendChild(moduleDiv);
            });
        }

        function checkSystemStatus() {
            const statusIndicator = document.getElementById('system-status');
            const isSystemHealthy = window.electronAPI && window.nodeAPI;
            
            if (isSystemHealthy) {
                statusIndicator.className = 'status-indicator online';
            } else {
                statusIndicator.className = 'status-indicator warning';
            }

            document.getElementById('last-update').textContent = 
                `Last Update: ${new Date().toLocaleTimeString()}`;
        }

        window.runAllTests = async function() {
            showLoading(true);
            showResults(true);
            
            const resultsDiv = document.getElementById('test-output');
            resultsDiv.innerHTML = '<div class="loading"></div> Running comprehensive tests...';
            
            try {
                const results = await testEnvironment.runAllTests();
                currentTests = results;
                displayTestResults(results);
                
                // Update test count
                const totalTests = results.reduce((sum, result) => 
                    sum + (result.tests ? result.tests.length : 0), 0);
                const passedTests = results.reduce((sum, result) => 
                    sum + (result.tests ? result.tests.filter(t => t.result).length : 0), 0);
                
                document.getElementById('test-count').textContent = 
                    `Tests: ${passedTests} / ${totalTests}`;
                    
                // Update system status
                const systemStatus = document.getElementById('system-status');
                if (passedTests / totalTests > 0.8) {
                    systemStatus.className = 'status-indicator online';
                } else if (passedTests / totalTests > 0.5) {
                    systemStatus.className = 'status-indicator warning';
                } else {
                    systemStatus.className = 'status-indicator offline';
                }
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="test-result error">
                    <div class="test-name">Test Suite Error</div>
                    <div class="test-details">${error.message}</div>
                </div>`;
            }
            
            showLoading(false);
        };

        window.runModuleTest = async function(moduleName) {
            const statusDiv = document.getElementById(`status-${moduleName}`);
            statusDiv.innerHTML = '<div class="loading"></div> Testing...';
            
            try {
                const result = await testEnvironment.runModuleTest(moduleName);
                
                if (result && result.tests) {
                    const passed = result.tests.filter(test => test.result).length;
                    const total = result.tests.length;
                    const success = passed === total;
                    
                    statusDiv.innerHTML = `${passed}/${total} tests ${success ? '‚úÖ' : '‚ùå'}`;
                    statusDiv.style.color = success ? '#00ff88' : '#ff4757';
                    
                    // Show detailed results
                    showResults(true);
                    displayTestResults([result]);
                } else {
                    statusDiv.innerHTML = 'No tests found';
                    statusDiv.style.color = '#ffa502';
                }
                
            } catch (error) {
                statusDiv.innerHTML = `Error: ${error.message}`;
                statusDiv.style.color = '#ff4757';
            }
        };

        window.exportDiagnostics = function() {
            try {
                testEnvironment.exportDiagnostics();
                alert('‚úÖ Diagnostics exported successfully! Check your downloads folder.');
            } catch (error) {
                alert(`‚ùå Export failed: ${error.message}`);
            }
        };

        window.generateSupportReport = function() {
            try {
                const report = testEnvironment.generateSupportReport();
                
                // Create a modal or new window to display the report
                const reportWindow = window.open('', '_blank', 'width=800,height=600');
                reportWindow.document.write(`
                    <html>
                        <head>
                            <title>RinaWarp Terminal Support Report</title>
                            <style>
                                body { font-family: monospace; padding: 20px; background: #1e1e2e; color: #fff; }
                                pre { background: #2d3748; padding: 15px; border-radius: 5px; overflow: auto; }
                            </style>
                        </head>
                        <body>
                            <h1>RinaWarp Terminal Support Report</h1>
                            <pre>${report}</pre>
                            <button onclick="navigator.clipboard.writeText(document.querySelector('pre').textContent)">
                                Copy to Clipboard
                            </button>
                        </body>
                    </html>
                `);
                reportWindow.document.close();
                
            } catch (error) {
                alert(`‚ùå Report generation failed: ${error.message}`);
            }
        };

        window.clearResults = function() {
            showResults(false);
            currentTests = [];
            document.getElementById('test-count').textContent = 'Tests: 0 / 0';
            
            // Reset module statuses
            const modules = ['electronAPI', 'ipcBridge', 'pluginLoader', 'uiManager', 'errorTriageSystem', 'performanceMonitor'];
            modules.forEach(module => {
                const statusDiv = document.getElementById(`status-${module}`);
                statusDiv.innerHTML = 'Click to test';
                statusDiv.style.color = '#cccccc';
            });
        };

        function showResults(show) {
            document.getElementById('results').style.display = show ? 'block' : 'none';
        }

        function showLoading(show) {
            // Implementation for loading state
        }

        function displayTestResults(results) {
            const output = document.getElementById('test-output');
            
            let html = '';
            results.forEach(result => {
                if (result.tests) {
                    result.tests.forEach(test => {
                        const cssClass = test.result ? 'success' : 'error';
                        const icon = test.result ? '‚úÖ' : '‚ùå';
                        
                        html += `
                            <div class="test-result ${cssClass}">
                                <div class="test-name">${icon} ${result.name} - ${test.name}</div>
                                <div class="test-details">${test.details}</div>
                            </div>
                        `;
                    });
                } else if (result.error) {
                    html += `
                        <div class="test-result error">
                            <div class="test-name">‚ùå ${result.name}</div>
                            <div class="test-details">Error: ${result.error}</div>
                        </div>
                    `;
                }
            });
            
            output.innerHTML = html;
        }
    </script>
</body>
</html>
