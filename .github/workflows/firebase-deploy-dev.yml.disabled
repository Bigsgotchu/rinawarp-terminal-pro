name: 🔥 Firebase Deploy (Development)

on:
  # Only run on manual trigger to save Actions minutes
  workflow_dispatch:
    inputs:
      skip_build:
        description: 'Skip build step (if already built)'
        required: false
        default: false
        type: boolean
      deploy_message:
        description: 'Custom deployment message'
        required: false
        default: 'Development deployment'

jobs:
  firebase-deploy-dev:
    name: 🔥 Quick Deploy to Firebase
    runs-on: ubuntu-latest
    
    steps:
      - name: 📦 Checkout code
        uses: actions/checkout@v4

      - name: ⚙️ Install Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm

      - name: 📁 Install dependencies (cached)
        run: npm ci --prefer-offline --no-audit

      - name: 🛠️ Build app
        if: ${{ !inputs.skip_build }}
        run: npm run build:web

      - name: 🧜‍♀️ Firebase Deploy
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
        run: |
          npm install -g firebase-tools
          firebase deploy --only hosting --message "${{ inputs.deploy_message }}" --project rinawarp-terminal

      - name: ✨ Deployment Status
        run: |
          echo "🌊 ${{ inputs.deploy_message }} complete!"
          echo "🔗 Live at: https://rinawarp-terminal.web.app"
