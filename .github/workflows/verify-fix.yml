name: 🔍 Verify Workflow Fix

on:
  workflow_dispatch:
  push:
    paths:
      - '.github/workflows/**'

env:
  ACTIONS_RUNNER_DEBUG: true

jobs:
  verify:
    name: ✅ Verify GitHub Actions Work
    runs-on: ubuntu-latest
    
    steps:
      - name: 📦 Checkout
        uses: actions/checkout@v4
      
      - name: ⚙️ Setup Node.js  
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: 🧠 Environment Info
        run: |
          echo "🖥️ OS: $(uname -a)"
          echo "🔧 Architecture: $(arch)"
          echo "📊 Runner: ${{ runner.os }}"
          echo "📱 GitHub Event: ${{ github.event_name }}"
          
      - name: ✅ Validate package.json
        run: |
          echo "📝 Validating package.json schema..."
          node -e "import fs from 'fs'; const pkg = JSON.parse(fs.readFileSync('package.json')); if (!pkg.name || !pkg.version) throw new Error('Missing name or version'); console.log('✅ package.json is valid');"
          
      - name: 🔍 Workflow YAML Validation
        run: |
          echo "🔍 Checking all workflow files..."
          for file in .github/workflows/*.yml; do
            echo "Validating: $file"
            node -e "import yaml from 'js-yaml'; import fs from 'fs'; yaml.load(fs.readFileSync('$file', 'utf8')); console.log('✅', '$file', 'is valid');"
          done
          
      - name: 🎯 Test Basic Commands
        run: |
          echo "✅ RinaWarp Terminal Enterprise"
          echo "🌊 GitHub Actions is working!"
          echo "📦 Package: $(node -e "import fs from 'fs'; const pkg = JSON.parse(fs.readFileSync('package.json')); console.log(pkg.name)")"
          echo "🏷️ Version: $(node -e "import fs from 'fs'; const pkg = JSON.parse(fs.readFileSync('package.json')); console.log(pkg.version)")"
          echo "📋 Node.js version: $(node --version)"
          echo "📊 npm version: $(npm --version)"
          
      - name: 🧜‍♀️ Success Report
        run: |
          echo "🎉 GitHub Workflows are now functioning properly!"
          echo "✅ YAML syntax validated"  
          echo "✅ Node.js environment working"
          echo "✅ Repository access confirmed"
          echo "✅ ES module compatibility verified"
          echo ""
          echo "🚀 You can now use GitHub Actions for CI/CD"
