name: ⚡ Ultra-Minimal CI

# Only run on main branch to save minutes
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# Ultra-minimal permissions
permissions:
  contents: read

jobs:
  # Single job that does everything in one run
  quick-check:
    name: 🚀 Quick Health Check
    runs-on: ubuntu-latest
    # Set a short timeout to prevent minute consumption
    timeout-minutes: 5
    
    steps:
      - name: Checkout (minimal)
        uses: actions/checkout@v4
        with:
          fetch-depth: 1  # Minimal clone
          
      - name: Multi-step validation
        run: |
          echo "🔍 Repository structure check..."
          ls -la
          
          echo "📦 Package.json validation..."
          if [ -f "package.json" ]; then
            echo "✅ package.json exists"
            node -e "const pkg = require('./package.json'); console.log('✅ Valid JSON:', pkg.name, pkg.version)"
          else
            echo "❌ package.json missing"
          fi
          
          echo "🔧 Basic file checks..."
          echo "  - Source files: $(find src -name '*.js' -o -name '*.cjs' 2>/dev/null | wc -l)"
          echo "  - Workflows: $(find .github/workflows -name '*.yml' 2>/dev/null | wc -l)"
          echo "  - Scripts: $(find scripts -name '*.js' -o -name '*.cjs' 2>/dev/null | wc -l)"
          
          echo "🎯 Health check complete - consuming minimal minutes!"
          echo "💡 This workflow uses <1 minute per run"
          
          # Only fail if critical issues found
          if [ ! -f "package.json" ]; then
            echo "❌ Critical: package.json missing"
            exit 1
          fi
          
          echo "✅ All health checks passed!"
