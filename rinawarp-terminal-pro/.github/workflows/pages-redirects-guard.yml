name: Pages Redirects Guard

on:
  push:
    branches: [ "main", "master" ]
  pull_request:

jobs:
  redirects_guard:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Verify _redirects exists in canonical Pages output
        run: |
          set -euo pipefail

          # Prefer canonical deploy root. Keep fallback for legacy trees.
          if [[ -f "rinawarptech-website/web/_redirects" ]]; then
            PAGES_OUT="rinawarptech-website/web"
          elif [[ -f "apps/marketing-web/_redirects" ]]; then
            PAGES_OUT="apps/marketing-web"
          else
            echo "ℹ️ No website Pages output root in this tree; skipping redirects guard."
            echo "Checked: rinawarptech-website/web and apps/marketing-web"
            exit 0
          fi

          echo "✅ Found ${PAGES_OUT}/_redirects"
          echo "---"
          sed -n '1,120p' "${PAGES_OUT}/_redirects"

      - name: Guard Rina contract docs
        run: |
          bash rinawarp-terminal-pro/scripts/ci-contract-guard.sh
