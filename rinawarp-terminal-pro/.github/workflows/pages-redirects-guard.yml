name: Pages Redirects Guard

on:
  push:
    branches: [ "main", "master" ]
  pull_request:

jobs:
  redirects_guard:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # If your Pages output is repo root, leave PAGES_OUT as "."
      # If your Pages output is a folder (e.g. "apps/marketing-web"),
      # change PAGES_OUT below.
      - name: Verify _redirects exists in Pages output
        run: |
          set -euo pipefail
          PAGES_OUT="apps/marketing-web"
          test -f "${PAGES_OUT}/_redirects" || (echo "❌ Missing ${PAGES_OUT}/_redirects (Cloudflare Pages will not apply redirects)" && exit 1)
          echo "✅ Found ${PAGES_OUT}/_redirects"
          echo "---"
          sed -n '1,120p' "${PAGES_OUT}/_redirects"
