<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple RinaWarp Terminal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background: #000;
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }
        
        #terminal {
            width: 100%;
            height: 100vh;
            padding: 20px;
        }
        
        .status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 255, 136, 0.2);
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="status" id="status">Loading...</div>
    <div id="terminal"></div>

    <script type="module">
        console.log('üöÄ Starting Simple RinaWarp Terminal');
        
        // Simple, direct import - no complex strategies
        import { Terminal } from './node_modules/@xterm/xterm/lib/xterm.js';
        import { FitAddon } from './node_modules/@xterm/addon-fit/lib/addon-fit.js';
        
        // Simple CSS load
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = './node_modules/@xterm/xterm/css/xterm.css';
        document.head.appendChild(link);
        
        async function initializeTerminal() {
            try {
                console.log('üì¶ Creating terminal...');
                
                // Create terminal with simple config
                const terminal = new Terminal({
                    fontFamily: '"Cascadia Code", Consolas, "Courier New", monospace',
                    fontSize: 14,
                    cursorBlink: true,
                    theme: {
                        background: '#000000',
                        foreground: '#ffffff',
                        cursor: '#00ff88',
                        cursorAccent: '#000000',
                        selection: '#ffffff33'
                    }
                });
                
                // Load fit addon
                const fitAddon = new FitAddon();
                terminal.loadAddon(fitAddon);
                
                // Open terminal
                terminal.open(document.getElementById('terminal'));
                fitAddon.fit();
                
                // Handle resize
                window.addEventListener('resize', () => fitAddon.fit());
                
                console.log('‚úÖ Terminal created successfully');
                document.getElementById('status').textContent = 'Ready';
                
                // Simple shell connection if Electron API is available
                if (window.electronAPI) {
                    console.log('üîó Connecting to shell...');
                    
                    try {
                        await window.electronAPI.createShellProcess({
                            shell: '/bin/bash',
                            terminalId: 'simple-terminal'
                        });
                        
                        // Handle data from shell
                        window.electronAPI.onShellData('simple-terminal', (data) => {
                            terminal.write(data);
                        });
                        
                        // Handle input to shell
                        terminal.onData((data) => {
                            window.electronAPI.sendToShell('simple-terminal', data);
                        });
                        
                        console.log('‚úÖ Shell connected');
                        document.getElementById('status').textContent = 'Shell Connected';
                        
                        // Send initial command to test
                        terminal.writeln('Welcome to Simple RinaWarp Terminal!');
                        terminal.writeln('Shell connected successfully.');
                        
                    } catch (error) {
                        console.warn('‚ö†Ô∏è Shell connection failed:', error);
                        terminal.writeln('‚ö†Ô∏è Shell connection failed. Running in fallback mode.');
                        document.getElementById('status').textContent = 'Fallback Mode';
                        
                        // Fallback: just echo input
                        terminal.onData((data) => {
                            if (data === '\r' || data === '\n') {
                                terminal.write('\r\n$ ');
                            } else {
                                terminal.write(data);
                            }
                        });
                        terminal.write('$ ');
                    }
                } else {
                    console.log('üì± No Electron API - web fallback mode');
                    terminal.writeln('Simple RinaWarp Terminal (Web Mode)');
                    terminal.writeln('Type anything to test...');
                    document.getElementById('status').textContent = 'Web Mode';
                    
                    // Simple echo for web mode
                    terminal.onData((data) => {
                        if (data === '\r' || data === '\n') {
                            terminal.write('\r\n> ');
                        } else {
                            terminal.write(data);
                        }
                    });
                    terminal.write('> ');
                }
                
                // Focus terminal
                terminal.focus();
                
            } catch (error) {
                console.error('‚ùå Terminal initialization failed:', error);
                document.getElementById('status').textContent = `Error: ${error.message}`;
                
                // Show error in terminal area
                document.getElementById('terminal').innerHTML = `
                    <div style="padding: 20px; color: #ff5555;">
                        <h2>Terminal Failed to Load</h2>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p><strong>Stack:</strong></p>
                        <pre style="color: #ffff55; font-size: 12px;">${error.stack}</pre>
                        <p style="margin-top: 20px; color: #55ffff;">
                            This is the simplified terminal. If this fails, the issue is with 
                            XTerm.js package installation or module resolution.
                        </p>
                    </div>
                `;
            }
        }
        
        // Wait for DOM and initialize
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeTerminal);
        } else {
            initializeTerminal();
        }
    </script>
</body>
</html>
